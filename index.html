<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Rulerbundle by rezzza</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Rulerbundle</h1>
          <h2>A simple stateless production rules engine for Symfony 2</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/rezzza/RulerBundle/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/rezzza/RulerBundle/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/rezzza/RulerBundle" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>RulerBundle</h1>

<p><a href="http://travis-ci.org/rezzza/RulerBundle"><img src="https://secure.travis-ci.org/rezzza/RulerBundle.png" alt="Build Status"></a></p>

<p>A simple stateless production rules engine for Symfony 2.</p>

<h1>Roadmap</h1>

<ul>
<li>Create dynamically Propositions via a Form and persist them on storage.</li>
<li>Create a DSL to insert/fetch on storage. (using hoa/compiler ?)</li>
<li>Create a standalone library + a bundle.</li>
</ul><h1>Configuration</h1>

<pre><code>rezzza_ruler:
    inferences:
        cart.price_total:
            type:        decimal
            description: Cart total price is
        cart.created_at:
            type:        date
            description: Cart was created at
        cart.contain_product:
            type:        product
            # Your own asserter (see chapter Add an asserter)
            # You'll return a list of product as array.
            # Not yet implemented, we'll have to finish ui via forms.
            description: Cart contain product
</code></pre>

<h1>Usage</h1>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//use Ruler\Rule;</span>
<span class="c1">//use Ruler\Operator;</span>
<span class="c1">//use Ruler\Context;</span>

<span class="nv">$inferenceContainer</span> <span class="o">=</span> <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'rezzza.ruler.inference_container'</span><span class="p">);</span>

<span class="nv">$rule</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rule</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Operator\LogicalAnd</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="nv">$inferenceContainer</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'cart.price_total'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">createProposition</span><span class="p">(</span><span class="s1">'&gt;='</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="nv">$inferenceContainer</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'cart.created_at'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">createProposition</span><span class="p">(</span><span class="s1">'&gt;='</span><span class="p">,</span> <span class="s1">'2011-06-10'</span><span class="p">),</span>
    <span class="p">))</span>
<span class="p">);</span>

<span class="nv">$context</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Context</span><span class="p">();</span>
<span class="nv">$context</span><span class="p">[</span><span class="s1">'cart.price_total'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">110</span><span class="p">;</span>
<span class="nv">$context</span><span class="p">[</span><span class="s1">'cart.created_at'</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$rule</span><span class="o">-&gt;</span><span class="na">evaluate</span><span class="p">(</span><span class="nv">$context</span><span class="p">)</span> <span class="o">?</span> <span class="s1">'OK'</span><span class="o">:</span> <span class="s1">'NOPE'</span><span class="p">;</span> <span class="c1">// OK;</span>
</pre></div>

<h1>Serialization</h1>

<p>To store rules on a storage, you can serialize it, store it on storage, fetch it from storage, and deserialize it. Context does not stay on storage.</p>

<div class="highlight"><pre><span class="nv">$factory</span> <span class="o">=</span> <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'rezzza.ruler.factory'</span><span class="p">);</span>

<span class="nv">$rule</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rule</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">Operator\LogicalAnd</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="nv">$inferenceContainer</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'cart.price_total'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">createProposition</span><span class="p">(</span><span class="s1">'&gt;='</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="nv">$inferenceContainer</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'cart.created_at'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">createProposition</span><span class="p">(</span><span class="s1">'&gt;='</span><span class="p">,</span> <span class="s1">'2011-06-10'</span><span class="p">),</span>
    <span class="p">))</span>
<span class="p">);</span>

<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">serialize</span><span class="p">(</span><span class="nv">$rule</span><span class="p">);</span> <span class="c1">// will return a linear serialization of object.</span>

<span class="nv">$rule</span> <span class="o">=</span> <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">unserialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span> <span class="c1">// will be equals to $rule above :).</span>
</pre></div>

<h1>Add an asserter.</h1>

<p>In this example, we'll create <code>product</code> asserter, this one will fetch on storage a list of products.</p>

<h2>1) Create asserter class</h2>

<div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Acme\Bundle\Asserter\Product</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Rezzza\RulerBundle\Ruler\Asserter\AbstractAsserter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Rezzza\RulerBundle\Ruler\Asserter\AsserterInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Product</span> <span class="k">extends</span> <span class="nx">AbstractAsserter</span> <span class="k">implements</span> <span class="nx">AsserterInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// here we have to define operators and them callback.</span>
<span class="p">,</span>
        <span class="c1">// $left  is the product id you choosed on UI (WIP)</span>
        <span class="c1">// $right is what you entered on context with key "cart.contain_product"</span>
        <span class="c1">// We suppose here $right is an array and we would check if $left is in $right.</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">operators</span><span class="p">[</span><span class="s1">'contains'</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$left</span><span class="p">,</span> <span class="nv">$right</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">in_array</span><span class="p">(</span><span class="nv">$left</span><span class="p">,</span> <span class="nv">$right</span><span class="p">);</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2>2) Define the service and tag it.</h2>

<div class="highlight"><pre><span class="nt">&lt;services&gt;</span>
    <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">"acme.bundle.asserter.product"</span> <span class="na">class=</span><span class="s">"\Acme\Bundle\Asserter\Product"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">"rezzza.ruler.asserter"</span> <span class="na">id=</span><span class="s">"product"</span> <span class="nt">/&gt;</span>
        <span class="cp">&lt;! --- here, product is the KEY used on config.yml, important ! --&gt;</span>
    <span class="nt">&lt;/service&gt;</span>
<span class="nt">&lt;/service&gt;</span>

</pre></div>

<p>That's all folks !</p>

<h1>Glossary</h1>

<ul>
<li>Inference:   A group of proposition</li>
<li>Proposition: A rule attached to an inference.</li>
</ul><p>Any idea, suggestion ? <a href="https://github.com/rezzza/RulerBundle/issues/new">Create an issue</a>.</p>
        </section>

        <footer>
          Rulerbundle is maintained by <a href="https://github.com/rezzza">rezzza</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>